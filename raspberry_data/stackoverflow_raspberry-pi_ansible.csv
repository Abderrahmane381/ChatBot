ID,Title,Question,Top Answers,Score,Tags,Date
77695084,"ansible hostname module, set hostname based on ip address","im trying to use the ansible hostname module to change hostname of multiple raspberry pi compute module 4. because they are all based from the same raspberry pi os image, their hostname is raspberrypi for all of them, what i would like to change. my inventory is roughly like this rpicm41 nodenumber 1 name rpicm41 ansiblehost 192.168.1.101 rpicm42 nodenumber 2 name rpicm42 ansiblehost 192.168.1.102 ... and my playbook is like this name change hostname of managed nodes hosts rpicm42 tasks name change hostname of managed nodes ansible.builtin.hostname name quot hostvarsinventoryhostname.name quot when i run the playbook, the error im facing is this task gathering facts ok rpicm42 task change hostname of managed nodes fatal rpicm42 failed! gt changedfalse msg command failed rc1, out, errcould not set pretty hostname connection timed out i guess that maybe ansible is not using the ip address of the inventory but it used it for gathering facts. what could i do to make him use the ip of the inventory ? i could not manage to make ansible use the ip address. the vvv actually shows this task change hostname of managed nodes task path homencasauxhomelabansibletpi2rpicm4.tpi2rpios.yml75 lt192.168.1.102gt establish ssh connection for user pi lt192.168.1.102gt ssh exec sshpass d12 ssh c o controlmasterauto o controlpersist60s o userquotpiquot o connecttimeout10 o controlpathquothomencasaux.ansiblecped650a3305quot 192.168.1.102 binsh c quotquotecho pi ampamp sleep 0quotquot lt192.168.1.102gt 0, bhomepin, b lt192.168.1.102gt establish ssh connection for user pi lt192.168.1.102gt ssh exec sshpass d12 ssh c o controlmasterauto o controlpersist60s o userquotpiquot o connecttimeout10 o controlpathquothomencasaux.ansiblecped650a3305quot 192.168.1.102 binsh c quotquot umask 77 ampamp mkdir p quot echo homepi.ansibletmp quotampamp mkdir quot echo homepi.ansibletmpansibletmp1703118028.499653825006160853801334657 quot ampamp echo ansibletmp1703118028.499653825006160853801334657quot echo homepi.ansibletmpansibletmp1703118028.499653825006160853801334657 quot ampamp sleep 0quotquot lt192.168.1.102gt 0, bansibletmp1703118028.499653825006160853801334657homepi.ansibletmpansibletmp1703118028.499653825006160853801334657n, b using module file usrlibpython3distpackagesansiblemoduleshostname.py lt192.168.1.102gt put homencasaux.ansibletmpansiblelocal24823y1az1b7htmp3nxd67rj to homepi.ansibletmpansibletmp1703118028.499653825006160853801334657ansiballzhostname.py lt192.168.1.102gt ssh exec sshpass d12 sftp o batchmodeno b c o controlmasterauto o controlpersist60s o userquotpiquot o connecttimeout10 o controlpathquothomencasaux.ansiblecped650a3305quot 192.168.1.102 lt192.168.1.102gt 0, bsftpgt put homencasaux.ansibletmpansiblelocal24823y1az1b7htmp3nxd67rj homepi.ansibletmpansibletmp1703118028.499653825006160853801334657ansiballzhostname.pyn, b lt192.168.1.102gt establish ssh connection for user pi lt192.168.1.102gt ssh exec sshpass d12 ssh c o controlmasterauto o controlpersist60s o userquotpiquot o connecttimeout10 o controlpathquothomencasaux.ansiblecped650a3305quot 192.168.1.102 binsh c quotquotchmod ux homepi.ansibletmpansibletmp1703118028.499653825006160853801334657 homepi.ansibletmpansibletmp1703118028.499653825006160853801334657ansiballzhostname.py ampamp sleep 0quotquot lt192.168.1.102gt 0, b, b lt192.168.1.102gt establish ssh connection for user pi lt192.168.1.102gt ssh exec sshpass d12 ssh c o controlmasterauto o controlpersist60s o userquotpiquot o connecttimeout10 o controlpathquothomencasaux.ansiblecped650a3305quot tt 192.168.1.102 binsh c quotquotusrbinpython3 homepi.ansibletmpansibletmp1703118028.499653825006160853801334657ansiballzhostname.py ampamp sleep 0quotquot lt192.168.1.102gt 1, bx1b131m authenticating for org.freedesktop.hostname1.setstatichostname rnx1b0mauthentication is required to set the statically configured local hostname, as well as the pretty hostname.rnauthenticating as ,,, pirnpassword polkitagenthelper1 pamauthenticate failed authentication failurernrnquotfailedquot true, quotmsgquot quotcommand failed rc1, out, errcould not set pretty hostname connection timed outnquot, quotinvocationquot quotmoduleargsquot quotnamequot quot192.168.1.102quot, quotusequot nullrn, bshared connection to 192.168.1.102 closed.rn lt192.168.1.102gt failed to connect to the host via ssh shared connection to 192.168.1.102 closed. lt192.168.1.102gt establish ssh connection for user pi lt192.168.1.102gt ssh exec sshpass d12 ssh c o controlmasterauto o controlpersist60s o userquotpiquot o connecttimeout10 o controlpathquothomencasaux.ansiblecped650a3305quot 192.168.1.102 binsh c quotquotrm f r homepi.ansibletmpansibletmp1703118028.499653825006160853801334657 gt devnull 2gtamp1 ampamp sleep 0quotquot lt192.168.1.102gt 0, b, b fatal rpicm42 failed! gt changedfalse invocation moduleargs name 192.168.1.102 use null msg command failed rc1, out, errcould not set pretty hostname connection timed out so the ip seems to be used...","its pretty clearly using the ip address, so thats not the problem. it looks like ansible is connecting successfully, but it receiving an error when it attempts to set the system hostname. from the error message, it looks like a permissions problem authenticating for org.freedesktop.hostname1.setstatichostname authentication is required to set the statically configured local hostname, as well as the pretty hostname. authenticating as ,,, pi password polkitagenthelper1 pamauthenticate failed authentication failure you probably need to ensure that youre running the task as root on the remote host name change hostname of managed nodes hosts rpicm42 become true tasks name change hostname of managed nodes ansible.builtin.hostname name quot hostvarsinventoryhostname.name quot note the addition of become true, which will cause all tasks in this play to run as root.",-1,ansible;raspberry-pi;hostname,2023-12-21
69972968,a paradox putting my ansible server under cm control?,"im starting to learn about devops and configuration management cm. i am setting up my home network of raspi 4b devices, and i intend to configure them using ansible, following this guide on opensource.com. what i dont get though, is how i can possibly set up my ansible host server itself using cm as well? presumably, the host cant update the client if the client is the host itself! the guide i pointed to above implies that i should install ansible on a laptop or pc. that sounds great, but in the longerterm, i eventually want all of my home network devices to come under cm control, including the raspis, laptops amp pcs, and even our android phones. this suggests to me that the solution is a dedicated ansible host, running on a separate raspi. the paradox is, how do i get that host machine also to be under cm control, as well?","its perfectly fine to use ansible to configure controller. all you have to do is put a host in inventory with ansibleconnection local variable. there are few modules which are not working for localhost, though reboot, waitforconnection, etc. actually, many people uses ansible to configure their own linux laptops.",0,ansible;raspberry-pi;devops;raspberry-pi4,2021-11-15
68960741,different output from ansible version,"i am trying to get ansible 2.9 setup and configured on my raspberry pi 4 raspberry pi os 64bit if i run ansible version as a normal user, i get this ansible version ansible core 2.11.4 config file etcansibleansible.cfg configured module search path homestan.ansiblepluginsmodules, usrshareansiblepluginsmodules ansible python module location homestan.locallibpython3.7sitepackagesansible ansible collection location homestan.ansiblecollectionsusrshareansiblecollections executable location usrlocalbinansible python version 3.7.3 default, jan 22 2021, 200444 gcc 8.3.0 jinja version 2.10 libyaml true but when i run the same command as root, i get this ansible version ansible 2.9.25.post0 config file etcansibleansible.cfg configured module search path root.ansiblepluginsmodules, usrshareansiblepluginsmodules ansible python module location usrlocallibpython3.7distpackagesansible executable location usrlocalbinansible python version 3.7.3 default, jan 22 2021, 200444 gcc 8.3.0 btw stackoverflow forced be to format the above as code, but it is not code, it is command output. why do i get two different results depending on what user is running the command? the bigger questions which version is installed 2.9.25 root or 2.11.4 user?","you have two different versions installed. one is system in usrlocallibpython3.7distpackagesansible, and second is in user home directory homestan.locallibpython3.7sitepackagesansible the system binary in usrlocalbin is just loading entry points via import statement of python, therefore, the actual ansible version you see is very dependent on your import pathes configuration. the order of module loading is dependent on sys.path variable of python. gtgtgt import sys gtgtgt sys.path the source of sys.path is a very tricky question. see what sets up sys.path with python, and when?, but you may start from your .profile and pythonpath environment variable.",-2,ansible;raspberry-pi,2021-08-28
67409436,ansible ping test on raspberry pie,"i am looking for an ansible module that can ping using the cellular interface, and test the response. i am running it on my raspberry pie as a verification for the cellular connection. the equivalent to ping i wwan0 google.com i couldnt find a module that does this in a simple way or do it at all.","there is a ping module, but it does not take a source interface i as a parameter. what about using the command module? something simple like name ping google.com from interface wwan0 ansible.builtin.command ping i wwan0 google.com",-1,ansible;raspberry-pi,2021-05-05
63780817,ansible how to handle first login forced password change and push an sshkey,"using ansible to hardenize and configure servers raspberrypi arm64, everything works ok, but i need to manually login, change password and the push an ssh key to make my playbook work. current process. fresh installed ubuntu 20.04 first login user and password ubuntu so force to change password, so i need to fill 3.1 current password 3.2 new password 3.3 password confirmation sshcopyid i my sshkey ubuntuserver run my playbook to hardenize and do the rest of the job. is there any way to perform steps 1 to 4 through ansible instead of only manually? i was thinking to get this done with expect but as per my understanding it only will work after ansible has been authenticated.","by default, ansible will first connect to the host for gathering facts. if host is unable to be connected, ansible will return failed and stop. my strategy is disable gathering facts to prevent connection failed. now we can use expect to tackle the first login process, and set the public key. finally gather facts with setup if you need it. hosts hosts gatherfacts false tasks name quotcheck if host is reachablequot waitfor timeout 0 register connectrs ignoreunreachable yes when connectrs is unreachable name quottry first login and change the passwordquot delegateto localhost expect command sshpass p ansiblefirstloginpassword ssh ansiblesshcommonargs ansibleuser inventoryhostname timeout 10 responses quotcurrent passwordquot quot ansiblefirstloginpassword quot quotnew passwordquot quot ansiblepassword quot quotretype new passwordquot quot ansiblepassword quot name quotsetup the public key authenticationquot authorizedkey state present user quot ansibleuser quot key quot publickey quot name quotgather facts about hostquot setup || you can use sshpass the first time, so that you push your key and then work with a ssh key, and no pass from that point on sshpass p password ssh o stricthostkeycheckingno rootserver quotecho key gtgt .sshauthprizedkeysquot you can adjust the command for ssh any way you like, but i think the idea is clear?",5,ubuntu;ansible;raspberry-pi,2020-09-07
61903495,is it possible to setup a debian system in a deterministic manner?,"at work, we developed some python software that runs on raspbian debian based, on a raspberry pi. we have some ansible scripts that can take a fresh raspbian image, booted on a raspberry pi, and configure it to run our software. ansible does a few things installs some required packages with apt sets up a python virtual environment, and uses pip, and a requirements file, to install the exact version of python libraries we need to run our software the fact that every time ansible runs, it will install the exact version of the python libraries from pypi that we have tested our software with is great. unfortunately, this does not apply to the packages installed through apt. doing aptget install package, or the ansible equivalent, installs the latest version of that package. what the version is today, may not be the same as what it is tomorrow. that means if i run my ansible scripts to setup a raspberry pi today, my software might work perfectly, but running ansible on a fresh raspberry pi tomorrow might install newer versions of software from apt, which may break our software. is there any way to do what pip does, but for apt? freeze the currentlyinstalled versions of packages, and later, when installing on a fresh system, install those exact versions of packages? or something similar. i know we can install whatever versions of packages we want, and clone the sd card to other pis, but that kind of defeats the purpose of having ansible scripts in the first place.",with ansible you can specify which version of a packge to install this way. name install the version 1.00 of package foo apt name foo1.00 and then to prevent the package to be uprgraded in case of a system upgrade mark the package as hold this way dpkgselections name python selection hold || there is this tool thats worth mentioning. a wrapper around apt and aptget that enforces package install determinism. inspired by packagelock.json from npm.,2,python;linux;ansible;raspberry-pi,2020-05-20
61257164,ansible is using wrong version of python,"i have been dealing with this issue for a couple of days now. i am running ansible on a raspberry pi. i have made python3.7 the default version of python. apparently ansible wants to use python 2.7. i have added version 3.7 in the vars in the playbook but this does not change the module location. it still looks for the modules in python 2.7. i am not sure how to tell ansible to use 3.7 for all the modules and the interpreter. pipi python version python 3.7.2 pipi ansibleplaybook vm.yaml vv ansibleplaybook 2.9.6 config file etcansibleansible.cfg configured module search path uhomepi.ansiblepluginsmodules, uusrshareansiblepluginsmodules ansible python module location usrlibpython2.7distpackagesansible executable location usrbinansibleplaybook python version 2.7.16 default, oct 10 2019, 220215 gcc 8.3.0 using etcansibleansible.cfg as config file warning provided hosts list is empty, only localhost is available. note that the implicit localhost does not match all playbook vm.yaml 1 plays in vm.yaml play localhost task gathering facts task path homepivm.yaml12 ok localhost meta ran handlers task gather info about the vmware guest vm task path homepivm.yaml28 an exception occurred during task execution. to see the full traceback, use vvv. the error was modulenotfounderror no module named pyvim fatal localhost gt localhost failed! gt changed false, msg failed to import the required python library pyvmomi on pis python usrbinpython3. please read module documentation and install in the appropriate location. if the required library is installed, but ansible is using the wrong python interpreter, please consult the documentation on ansiblepythoninterpreter play recap localhost ok1 changed0 unreachable0 failed1 skipped0 rescued0 ignored0 pipi","to let ansible use the python version other than what it is taking by default, you can use ansible.cfg file inside the project root from where you are running ansibleplaybook command. this file is like a configuration file from which ansible picks up details when it executes a playbook. once of its configuration option is interpreterpython where you specify the executable path. lets do this step by step first find the executable path of the python version you would like ansible to use. e.g. if it is python 3.10, you would run which python3.10 from your terminal. it will give you something like usrlocalbinpython3.10 in the outputwhich may change if you have it installed in a different directory. create a file called ansible.cfg in the project root from where you are running your playbooks and add following defaults stdoutcallback debug interpreterpython usrlocalbinpython3.10 now when you run the playbooks from this directory, ansible will take the interpreterpython configuration and use python3.10 an important note that now if you run ansibleplaybook version it might still show you the older python version it was using. but when you execute the playbook, it will take the ansible.cfg file into account. || q quothow to tell ansible to use 3.7quot a its not possible to select the version of python the ansible utilities are running on. this version of python depends on how the ansible utilitiespackage were built. this is the python version the utilities will display shellgt ansible version ansible core 2.14.1 config file exportscratchtmp7test206ansible.cfg configured module search path homeadmin.ansiblepluginsmodules, usrshareansiblepluginsmodules ansible python module location homeadmin.locallibpython3.9sitepackagesansible ansible collection location homeadmin.locallibpython3.9sitepackages executable location homeadmin.localbinansible python version 3.9.16 main, dec 7 2022, 011151 gcc 9.4.0 usrbinpython3.9 jinja version 3.1.2 libyaml true the utilities below will display the same shellgt ansibleplaybook version shellgt ansibleinventory version ... there may be more versions of python installed both on the controller and on the remote hosts. its a complex process of how ansible selects which version of python will be used to execute the modules on a remote host. see interpreter discovery quotunless configured otherwise, ansible will attempt to discover a suitable python interpreter on each target host.quot interpreterpython quotconfiguration options how to select python on the remote hosts.quot debugging modules to learn details on how the ansible modules are executed on a remote host. setting the python interpreter in bsd its necessary to understand that ansible can manage both remote hosts and localhost. for example, on the controller localhost, this ansible utility uses python version 3.9.16. the version of python to execute the modules may be different. shellgt ls 1 usrbin egrep python2,3.09 python2.7 python3.8 python3.9 by default, ansible discovered usrbinpython3 in ubuntu which is a link to python3.8 shellgt ansible localhost m setup grep i python quotansiblepythonquot quotexecutablequot quotusrbinpython3quot, quottypequot quotcpythonquot, quotansiblepythonversionquot quot3.8.5quot, quotansibleselinuxpythonpresentquot true, quotdiscoveredinterpreterpythonquot quotusrbinpython3quot, shellgt ll usrbinpython3 lrwxrwxrwx 1 root root 9 apr 27 2020 usrbinpython3 gt python3.8 you can configure interpreterpython in many different ways a in the variable ansiblepythoninterpreter on the command line shellgt ansible localhost m setup e ansiblepythoninterpreterusrbinpython3.9 grep i python quotansiblepythonquot quotexecutablequot quotusrbinpython3.9quot, quottypequot quotcpythonquot, quotansiblepythonversionquot quot3.9.16quot, quotansibleselinuxpythonpresentquot true, , but you can declare the variable in other precedence and in various scopes. see variable precedence where should i put a variable?. you can even configure different versions for single tasks. for example, hosts localhost tasks command quotecho ansiblepythoninterpreter quot register out vars ansiblepythoninterpreter usrbinpython3.8 debug var out.stdout command quotecho ansiblepythoninterpreter quot register out vars ansiblepythoninterpreter usrbinpython3.9 debug var out.stdout gives abridged task command changed localhost task debug ok localhost gt out.stdout usrbinpython3.8 task command changed localhost task debug ok localhost gt out.stdout usrbinpython3.9 b in the environment variable ansiblepythoninterpreter on the command line shellgt ansiblepythoninterpreterusrbinpython3.9 ansible localhost m setup grep i python quotansiblepythonquot quotexecutablequot quotusrbinpython3.9quot, quottypequot quotcpythonquot, quotansiblepythonversionquot quot3.9.16quot, quotansibleselinuxpythonpresentquot true, c in the configuration shellgt grep b 1 interpreterpython ansible.cfg defaults interpreterpython usrbinpython3.9 shellgt ansible localhost m setup grep i python quotansiblepythonquot quotexecutablequot quotusrbinpython3.9quot, quottypequot quotcpythonquot, quotansiblepythonversionquot quot3.9.16quot, quotansibleselinuxpythonpresentquot true, d in the inventory for a single host shellgt cat hosts localhost ansiblepythoninterpreterusrbinpython3.9 shellgt ansible localhost m setup grep i python quotansiblepythonquot quotexecutablequot quotusrbinpython3.9quot, quottypequot quotcpythonquot, quotansiblepythonversionquot quot3.9.16quot, quotansibleselinuxpythonpresentquot true, e in the inventory for a group of hosts shellgt cat hosts test test11 test12 test13 testvars ansibleuseradmin ansiblepythoninterpreterusrlocalbinpython3.8 shellgt ansible test11 m setup grep i python quotansiblepythonquot quotexecutablequot quotusrlocalbinpython3.8quot, quottypequot quotcpythonquot, quotansiblepythonversionquot quot3.8.12quot, quotstatusquot quotmissing selinux python libraryquot quotansibleselinuxpythonpresentquot false, || you probably need to change this. ansibleplaybook 2.9.6 config file etcansibleansible.cfg configured module search path uhomepi.ansiblepluginsmodules, uusrshareansiblepluginsmodules ansible python module location usrlibpython2.7distpackagesansible executable location usrbinansibleplaybook python version 2.7.16 default, oct 10 2019, 220215 gcc 8.3.0 python version is defined as 2.7.16, which you need to change.",3,python;python-3.x;ansible;raspberry-pi,2020-04-16
